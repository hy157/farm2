<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Mobil Tarƒ±m Oyunu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {height: 100%;margin: 0;padding: 0;background: #c7f6b6;font-family: 'Segoe UI', sans-serif;overflow: hidden;touch-action: manipulation;user-select: none;}
    #game {width: 100vw;height: 100vh;display: flex;flex-direction: column;justify-content: space-between;align-items: center;}
    #money-bar {width: 100vw;display: flex;align-items: center;justify-content: center;position: fixed;top: 0;left: 0;z-index: 50;background: rgba(255,255,255,0.38);box-shadow: 0 2px 15px rgba(30,60,30,0.05);height: 56px;font-size: 30px;font-weight: bold;letter-spacing: 2px;padding: 7px 0 7px 0;user-select: none;}
    #money-bar .dollar-emoji {font-size: 32px;margin-right: 13px;margin-top: 2px;filter: drop-shadow(0 1px 2px #8bce96);}
    #money-value {font-size: 31px;color: #25a16b;text-shadow: 0 1px 0 #fff, 0 1px 10px #98f1b3;margin-right: 6px;font-weight: 700;min-width: 70px;display: inline-block;text-align: right;letter-spacing: 1px;}
    #field-area {flex: 1 1 auto;width: 100vw;height: 100vh;position: absolute;top: 0;left: 0;z-index: 1;}
    .field {width: 160px;height: 160px;position: absolute;display: flex;align-items: center;justify-content: center;background: rgba(255,255,255,0.11);border-radius: 32px;box-shadow: 0 5px 22px 0 rgba(60,120,50,0.16), 0 1.5px 6px #a3d7a0 inset;cursor: pointer;transition: box-shadow 0.13s, background 0.15s;z-index: 2;border: 3.5px solid #e2f6e2;backdrop-filter: blur(2px);}
    .field-content {position: absolute;top: 0;left: 0;width: 100%;height: 100%;display: flex;align-items: center;justify-content: center;}
    .field-plot {width: 160px;height: 160px;position: absolute;top: 0;left: 0;pointer-events: none;z-index: 1;filter: drop-shadow(0 7px 16px rgba(0,0,0,0.14));border-radius: 28px;}
    .field-crop {width: 130px;height: 130px;pointer-events: none;z-index: 2;filter: drop-shadow(0 6px 18px rgba(0,0,0,0.12));position: relative;}
    .product-fly, .money-fly {position: absolute;width: 216px;height: 216px;pointer-events: none;z-index: 1001;transition: transform 2.1s cubic-bezier(.17,.67,.54,1.26), opacity 2.1s;will-change: transform, opacity;font-size: 100px;text-align: center;display: flex;align-items: center;justify-content: center;color: #25a16b;filter: drop-shadow(0 0 14px #d0ffd4);}
    #bottom-bar {width: 100vw;max-width: 500px;display: flex;justify-content: space-around;align-items: center;background: rgba(60,120,50,0.10);border-radius: 34px 34px 0 0;box-shadow: 0 -3px 22px 0 rgba(100,160,90,0.10);padding: 14px 0 20px 0;position: fixed;left: 50%;bottom: 0;transform: translateX(-50%);z-index: 10;backdrop-filter: blur(1.5px);}
    .game-btn {width: 70px;height: 70px;font-size: 38px;border: none;border-radius: 19px;background: #e9ffe1;box-shadow: 0 2px 8px 0 rgba(110,180,80,0.13);display: flex;align-items: center;justify-content: center;margin: 0 8px;transition: background 0.13s, transform 0.11s;cursor: pointer;position: relative;overflow: visible;}
    .game-btn:active {background: #c2f6ba;transform: scale(0.93);}
    #home-count {position: absolute;right: 10px;bottom: 5px;font-size: 20px;background: #fff;border-radius: 9px;padding: 3px 10px;box-shadow: 0 0 2px #999;color: #444;font-weight: 600;}
    #plant-modal {display: none;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -60%);background: #fafff7;border-radius: 26px;box-shadow: 0 4px 36px rgba(60,120,30,0.17);padding: 36px 26px 20px 26px;z-index: 100;text-align: center;min-width: 270px;}
    .plant-choice-row {display: flex;justify-content: center;gap: 44px;margin: 0 0 5px 0;}
    .plant-choice-wrap {display: flex;flex-direction: column;align-items: center;}
    .plant-choice-img {width: 105px;height: 105px;cursor: pointer;border-radius: 16px;border: 4px solid #ecf7eb;box-shadow: 0 3px 14px rgba(80,120,50,0.11);transition: border 0.13s, transform 0.13s, box-shadow 0.13s;background: #f6fff2;margin-bottom: 4px;}
    .plant-choice-img:active {border: 4px solid #bbffba;transform: scale(0.97);box-shadow: 0 1px 8px #befbc7;}
    .plant-price {font-size: 20px;color: #29b56e;font-weight: 600;background: #e4ffd6;padding: 2px 13px;border-radius: 8px;box-shadow: 0 1px 2px #cdebc9;margin-bottom: 2px;}
    #plant-modal button {margin: 18px 12px 0 12px;font-size: 19px;background: #f7e2e0;border: none;padding: 8px 20px;border-radius: 13px;cursor: pointer;transition: background 0.14s;color: #333;font-weight: 600;}
    #plant-modal button:active {background: #f3b9b2;}
    #home-modal {display: none;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -54%);background: #fdfff6;border-radius: 24px;box-shadow: 0 4px 28px rgba(80,130,30,0.13);padding: 32px 21px 21px 21px;z-index: 3000;min-width: 264px;text-align: center;user-select: none;}
    .close-x {position: absolute;top: 11px;right: 16px;font-size: 32px;font-weight: 600;color: #d1735a;cursor: pointer;background: none;border: none;z-index: 1;transition: color 0.14s, transform 0.13s;}
    .close-x:active {color: #ff3c1e;transform: scale(1.08) rotate(9deg);}
    .sell-row {display: flex;flex-direction: row;align-items: center;gap: 21px;margin: 22px 0 12px 0;justify-content: center;}
    .sell-img {width: 63px;height: 63px;border-radius: 14px;background: #f8fff2;box-shadow: 0 1px 8px #d5ffe5;border: 2px solid #e0fae8;display: flex;align-items: center;justify-content: center;}
    .sell-price {font-size: 23px;font-weight: 700;color: #228750;background: #e3ffe6;border-radius: 9px;padding: 4px 15px;box-shadow: 0 1px 2px #d2f8c9;margin-left: 3px;}
    .sell-count {font-size: 19px;color: #5f6265;font-weight: 500;margin-right: 7px;background: #fafcff;padding: 2px 6px;border-radius: 7px;border: 1.3px solid #e1e3e3;}
    @media (max-width: 700px) {.field, .field-plot { width: 120px; height: 120px;}.field-crop { width: 90px; height: 90px;}.product-fly, .money-fly { width: 162px; height: 162px; font-size: 72px;}.plant-choice-img { width: 74px; height: 74px;}.sell-img { width: 44px; height: 44px;}}
    @media (max-width: 420px) {.field, .field-plot { width: 90px; height: 90px;}.field-crop { width: 60px; height: 60px;}.product-fly, .money-fly { width: 121px; height: 121px; font-size: 49px;}.plant-choice-img { width: 54px; height: 54px;}.sell-img { width: 31px; height: 31px;}#bottom-bar { max-width: 99vw;}#plant-modal { min-width: 140px; padding: 10px 3px 7px 3px;}#home-modal { min-width: 110px; padding: 10px 2px 6px 2px;}#money-bar { font-size: 18px;}#money-bar .dollar-emoji { font-size: 19px;}}
  </style>
</head>
<body>
  <div id="game">
    <div id="money-bar">
      <span class="dollar-emoji">üíµ</span>
      <span id="money-value">100</span>
    </div>
    <div id="field-area"></div>
    <!-- Tarla Ekim Modalƒ± -->
    <div id="plant-modal">
      <div class="plant-choice-row">
        <div class="plant-choice-wrap">
          <img src="img/strawberry.png" class="plant-choice-img" onclick="choosePlant('strawberry')" id="choose-strawberry">
          <span class="plant-price">üíµ 60</span>
        </div>
        <div class="plant-choice-wrap">
          <img src="img/wheat.webp" class="plant-choice-img" onclick="choosePlant('wheat')" id="choose-wheat">
          <span class="plant-price">üíµ 40</span>
        </div>
      </div>
      <div>
        <button onclick="closeModal()">Vazge√ß</button>
      </div>
    </div>
    <!-- ALT BUTONLAR -->
    <div id="bottom-bar">
      <button class="game-btn" id="plant-btn" title="Ekim Yap (Kazma)">‚õèÔ∏è</button>
      <button class="game-btn" id="home-btn" title="Depo/Ev">
        üè†
        <span id="home-count">0</span>
      </button>
      <button class="game-btn" id="empty-btn" title="Buton 3">üß∫</button>
      <button class="game-btn" id="remove-btn" title="Tarlalarƒ± Sil">‚ùå</button>
    </div>
    <!-- Satƒ±≈ü Modalƒ± -->
    <div id="home-modal">
      <button class="close-x" onclick="closeHomeModal()">√ó</button>
      <div class="sell-row">
        <span class="sell-count" id="wheat-count">0</span>
        <span class="sell-img"><img src="img/wheat.webp" style="width:100%;height:100%"></span>
        <span class="sell-price" id="wheat-price">$0.00</span>
        <button class="game-btn" style="width:40px;height:40px;font-size:22px;" onclick="sellProduct('wheat')">Sat</button>
      </div>
      <div class="sell-row">
        <span class="sell-count" id="strawberry-count">0</span>
        <span class="sell-img"><img src="img/strawberry.png" style="width:100%;height:100%"></span>
        <span class="sell-price" id="strawberry-price">$0.00</span>
        <button class="game-btn" style="width:40px;height:40px;font-size:22px;" onclick="sellProduct('strawberry')">Sat</button>
      </div>
    </div>
  </div>
  <script>
    let fields = []; // {x,y,type, div, timer, dried}
    let inventory = {wheat: 0, strawberry: 0};
    let homeCount = 0;
    let money = 100;
    let plantMode = false;
    let lastPlantPos = {x:0, y:0};
    let fieldArea = document.getElementById("field-area");
    const PRICES = {wheat: 40, strawberry: 60};
    const SELL_MINMAX = {wheat: [1.00,3.00], strawberry: [2.00,4.00]};
    let sellPrices = {wheat: 0, strawberry: 0};
    let priceInterval = null;
    const FIELD_SIZE = 160;
    const DRY_IMG = "img/Plot.webp";
    const IMAGES = {wheat: "img/wheat.webp", strawberry: "img/strawberry.png"};
    const PLOTS = {wheat: "img/Plot3.webp", strawberry: "img/PlotS3.webp"};

    function updateMoneyBar() {
      document.getElementById("money-value").textContent = money.toFixed(2);
    }
    document.getElementById("plant-btn").onclick = () => {
      plantMode = true;
      document.getElementById("plant-btn").style.background = "#f3d298";
    };

    // √áAKI≈ûMA KONTROL√ú
    function isOverlap(x, y) {
      for (let f of fields) {
        if (!f) continue;
        let fx = f.x, fy = f.y;
        if (Math.abs(x-fx) < FIELD_SIZE-6 && Math.abs(y-fy) < FIELD_SIZE-6) return true;
      }
      return false;
    }

    fieldArea.onclick = function(e) {
      if (!plantMode) return;
      if (e.target !== fieldArea) return;
      const rect = fieldArea.getBoundingClientRect();
      let x = e.clientX - rect.left - FIELD_SIZE/2;
      let y = e.clientY - rect.top - FIELD_SIZE/2;
      if (isOverlap(x, y)) {
        plantMode = false;
        document.getElementById("plant-btn").style.background = "#e9ffe1";
        return;
      }
      lastPlantPos = {x, y};
      openModal();
      plantMode = false;
      document.getElementById("plant-btn").style.background = "#e9ffe1";
    };

    const plantModal = document.getElementById("plant-modal");
    function openModal() {
      plantModal.style.display = "block";
      document.getElementById('choose-strawberry').style.opacity = money >= PRICES.strawberry ? '1' : '0.3';
      document.getElementById('choose-wheat').style.opacity = money >= PRICES.wheat ? '1' : '0.3';
      document.getElementById('choose-strawberry').style.pointerEvents = money >= PRICES.strawberry ? 'auto' : 'none';
      document.getElementById('choose-wheat').style.pointerEvents = money >= PRICES.wheat ? 'auto' : 'none';
    }
    function closeModal() {
      plantModal.style.display = "none";
    }
    function choosePlant(type) {
      if (money < PRICES[type]) return;
      addField(lastPlantPos.x, lastPlantPos.y, type);
      flyMoney(PRICES[type], lastPlantPos.x + FIELD_SIZE/2, lastPlantPos.y + FIELD_SIZE/2, false);
      money -= PRICES[type];
      updateMoneyBar();
      closeModal();
    }

    // Tarla ekle (ve 1 dakika saya√ß)
    function addField(x, y, type) {
      let field = {x, y, type, dried: false};
      let div = document.createElement("div");
      field.div = div;
      div.className = "field";
      div.style.left = x + "px";
      div.style.top = y + "px";
      div.onclick = (ev) => {
        ev.stopPropagation();
        onFieldClick(div, field);
      };
      renderFieldContent(div, type, false);
      fieldArea.appendChild(div);
      fields.push(field);

      // 1 dakika sonra kurut!
      field.timer = setTimeout(()=>{
        field.dried = true;
        renderFieldContent(div, type, true);
      }, 60000);
    }
    // Kuruma ve ekili/ekilmemi≈ü g√∂rseliyle √ßiz
    function renderFieldContent(div, type, dried) {
      div.innerHTML = "";
      const fieldContent = document.createElement('div');
      fieldContent.className = 'field-content';
      const plotImg = document.createElement('img');
      plotImg.src = dried ? DRY_IMG : PLOTS[type];
      plotImg.className = 'field-plot';
      fieldContent.appendChild(plotImg);
      // Eƒüer kurumu≈üsa √ºr√ºn yok!
      if (!dried) {
        const cropImg = document.createElement('img');
        cropImg.src = IMAGES[type];
        cropImg.className = 'field-crop';
        fieldContent.appendChild(cropImg);
      }
      div.appendChild(fieldContent);
    }

    // Hasat
    function onFieldClick(div, field) {
      if (field.dried) return;
      for (let k=0;k<2;k++) {
        setTimeout(()=>flyProduct(div, field.type), k*200);
      }
    }
    function flyProduct(div, type) {
      const rect = div.getBoundingClientRect();
      const img = document.createElement('img');
      img.src = IMAGES[type];
      img.className = "product-fly";
      img.style.left = (rect.left + rect.width/2 - 108) + "px";
      img.style.top = (rect.top + rect.height/2 - 108) + "px";
      img.style.opacity = 1;
      img.style.position = "fixed";
      img.style.transform = "scale(1)";
      document.body.appendChild(img);
      const homeBtn = document.getElementById("home-btn");
      const hrect = homeBtn.getBoundingClientRect();
      setTimeout(()=>{
        img.style.transform = `translate(${hrect.left-rect.left+20}px, ${hrect.top-rect.top+8}px) scale(0.45)`;
        img.style.opacity = 0.18;
      },30);
      setTimeout(()=>{
        img.remove();
        updateHomeCount(type, 1);
      },2100);
    }
    function updateHomeCount(type, amount) {
      inventory[type] += amount;
      homeCount += amount;
      document.getElementById("home-count").textContent = homeCount;
    }

    // Para animasyonu (birden √ßok emoji, max 20)
    function flyMoney(amount, fromX, fromY, toBar=true) {
      let n = Math.floor(Math.min(Math.max(Math.round(amount), 1), 20));
      for(let i=0;i<n;i++) {
        let dollar = document.createElement('div');
        dollar.className = "money-fly";
        dollar.innerHTML = "üíµ";
        dollar.style.left = (fromX - 108) + "px";
        dollar.style.top = (fromY - 108) + "px";
        dollar.style.opacity = 1;
        dollar.style.position = "fixed";
        dollar.style.transform = "scale(1)";
        if (n>1 && i===0) {
          let txt = document.createElement('span');
          txt.textContent = " +" + amount.toFixed(2);
          txt.style.fontSize = "36px";
          txt.style.fontWeight = "700";
          txt.style.color = "#227d54";
          txt.style.marginLeft = "10px";
          txt.style.marginTop = "19px";
          dollar.appendChild(txt);
        }
        document.body.appendChild(dollar);
        const moneyBar = document.getElementById("money-bar");
        const rectBar = moneyBar.getBoundingClientRect();
        setTimeout(()=>{
          let tx = rectBar.left + rectBar.width/2 - fromX + (Math.random()-0.5)*20;
          let ty = rectBar.top + rectBar.height/2 - fromY + (Math.random()-0.5)*20;
          dollar.style.transform = `translate(${tx}px, ${ty}px) scale(0.6)`;
          dollar.style.opacity = 0.15;
        },30+60*i);
        setTimeout(()=>{
          dollar.remove();
        },2100+60*i);
      }
    }

    // Satƒ±≈ü modalƒ±
    document.getElementById("home-btn").onclick = function() {openHomeModal();};
    function openHomeModal() {
      document.getElementById("home-modal").style.display = "block";
      updateSellPrices();
      document.getElementById("wheat-count").textContent = inventory.wheat;
      document.getElementById("strawberry-count").textContent = inventory.strawberry;
      priceInterval = setInterval(updateSellPrices, 1000);
    }
    function closeHomeModal() {
      document.getElementById("home-modal").style.display = "none";
      if (priceInterval) { clearInterval(priceInterval); priceInterval = null; }
    }
    function updateSellPrices() {
      sellPrices.wheat = (Math.random()*(SELL_MINMAX.wheat[1]-SELL_MINMAX.wheat[0]) + SELL_MINMAX.wheat[0]);
      sellPrices.strawberry = (Math.random()*(SELL_MINMAX.strawberry[1]-SELL_MINMAX.strawberry[0]) + SELL_MINMAX.strawberry[0]);
      document.getElementById("wheat-price").textContent = "$" + sellPrices.wheat.toFixed(2);
      document.getElementById("strawberry-price").textContent = "$" + sellPrices.strawberry.toFixed(2);
    }
    function sellProduct(type) {
      let count = inventory[type];
      if (count <= 0) return;
      let price = sellPrices[type];
      let total = count * price;
      let iconEl = document.querySelector(".sell-img img[src*='"+type+"']");
      let iconRect = iconEl.getBoundingClientRect();
      flyMoney(total, iconRect.left + iconRect.width/2, iconRect.top + iconRect.height/2, true);
      money += total;
      inventory[type] = 0;
      homeCount -= count;
      if (homeCount < 0) homeCount = 0;
      document.getElementById("home-count").textContent = homeCount;
      updateMoneyBar();
      document.getElementById(type+"-count").textContent = 0;
    }

    // ‚ùå Tarlalarƒ± Sil (sadece kurumu≈ü/hasadƒ± yapƒ±lmƒ±≈ü tarlalar silinir)
    document.getElementById("remove-btn").onclick = function() {
      let removedCount = 0;
      for (let i=fields.length-1; i>=0; i--) {
        let f = fields[i];
        // Sadece kurumu≈ü ya da hasadƒ± yapƒ±lmƒ±≈ü (√ºr√ºn√º alƒ±nan) tarlalar silinir
        // Hasadƒ± yapƒ±lanƒ±: eƒüer kuruduysa ya da (√ºr√ºn hi√ß toplanmamƒ±≈üsa) inventory[type] > 0 deƒüilse
        if (f.dried || !f.type) {
          // Animasyon para
          let rect = f.div.getBoundingClientRect();
          flyMoney(2, rect.left+FIELD_SIZE/2, rect.top+FIELD_SIZE/2, true);
          money += 2;
          updateMoneyBar();
          if (f.timer) clearTimeout(f.timer);
          f.div.remove();
          fields.splice(i,1);
          removedCount++;
        }
      }
    };

    // Diƒüer butonlar dummy
    document.getElementById("empty-btn").onclick = () => {
      alert("Bu buton hen√ºz bir ≈üey yapmƒ±yor!");
    };

    updateMoneyBar();
  </script>
</body>
</html>
